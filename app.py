import streamlit as st
from oauth2client.service_account import ServiceAccountCredentials
import gspread
from datetime import datetime
import pandas as pd

# ---------- рдЧреВрдЧрд▓ рд╢реАрдЯ рдХрдиреЗрдХреНрд╢рди ----------
SCOPE = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
service_account_info = st.secrets["google_service_account"]
CREDS = ServiceAccountCredentials.from_json_keyfile_dict(service_account_info, SCOPE)
CLIENT = gspread.authorize(CREDS)
SHEET_NAME = "symptom_records"

# рд╡рд░реНрдХрд╢реАрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
try:
    sheet = CLIENT.open(SHEET_NAME).sheet1
except Exception as e:
    st.error(f"рдЧреВрдЧрд▓ рд╢реАрдЯ рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдореЗрдВ рддреНрд░реБрдЯрд┐: {e}")

# ---------- рдРрдк рдЯрд╛рдЗрдЯрд▓ ----------
st.set_page_config(page_title="рдЙрдиреНрдирдд рд▓рдХреНрд╖рдг-рдЖрдзрд╛рд░рд┐рдд рдмреАрдорд╛рд░реА рдЬрд╛рдВрдЪрдХрд░реНрддрд╛", page_icon="ЁЯПе", layout="wide")
st.title("ЁЯПе рдЙрдиреНрдирдд рд▓рдХреНрд╖рдг-рдЖрдзрд╛рд░рд┐рдд рдмреАрдорд╛рд░реА рдЬрд╛рдВрдЪрдХрд░реНрддрд╛")
st.write("рд▓рдХреНрд╖рдг рдЪреБрдиреЗрдВ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдмреАрдорд╛рд░реА рдХреЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд╕рд╛рде рджреЗрдЦреЗрдВред")

# ---------- рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╡рд░рдг рдлреЙрд░реНрдо ----------
with st.form("user_form"):
    col1, col2 = st.columns(2)
    with col1:
        name = st.text_input("ЁЯСд рдкреВрд░рд╛ рдирд╛рдо")
        age = st.number_input("ЁЯОВ рдЙрдореНрд░", min_value=0, max_value=120, step=1)
        gender = st.radio("тЪз рд▓рд┐рдВрдЧ", ["рдкреБрд░реБрд╖", "рдорд╣рд┐рд▓рд╛", "рдЕрдиреНрдп"])
        mobile = st.text_input("ЁЯУ▒ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░")
        weight = st.number_input("тЪЦ рд╡рдЬрди (рдХрд┐рд▓реЛрдЧреНрд░рд╛рдо)", min_value=1, max_value=300)
        height = st.number_input("ЁЯУП рд▓рдВрдмрд╛рдИ (рд╕реЗрдВрдЯреАрдореАрдЯрд░)", min_value=50, max_value=250)
        
    with col2:
        st.subheader("ЁЯй║ рдЪрд┐рдХрд┐рддреНрд╕рд╛ рдЗрддрд┐рд╣рд╛рд╕")
        bp = st.checkbox("рдЙрдЪреНрдЪ рд░рдХреНрддрдЪрд╛рдк")
        diabetes = st.checkbox("рдордзреБрдореЗрд╣")
        heart = st.checkbox("рд╣реГрджрдп рд╕рдВрдмрдВрдзреА рд╕рдорд╕реНрдпрд╛рдПрдВ")
        thyroid = st.checkbox("рдерд╛рдпрд░рд╛рдЗрдб рд╕рдорд╕реНрдпрд╛рдПрдВ")
        asthma = st.checkbox("рдЕрд╕реНрдердорд╛/рд╢реНрд╡рд╕рди рд╕рдВрдмрдВрдзреА рд╕рдорд╕реНрдпрд╛рдПрдВ")
        kidney = st.checkbox("рдХрд┐рдбрдиреА рд░реЛрдЧ")
        liver = st.checkbox("рд▓рд┐рд╡рд░ рд░реЛрдЧ")
        cancer_history = st.checkbox("рдХреИрдВрд╕рд░ рдХрд╛ рдкрд╛рд░рд┐рд╡рд╛рд░рд┐рдХ рдЗрддрд┐рд╣рд╛рд╕")
        location = st.text_input("ЁЯУН рд╕реНрдерд╛рди / рд╢рд╣рд░")

    st.subheader("ЁЯзН рд▓рдХреНрд╖рдг рдЪреБрдиреЗрдВ")

    # ---------- рдЙрдиреНрдирдд рд▓рдХреНрд╖рдг рд╕реВрдЪреА ----------
    fever_symptoms = [
        "рдмреБрдЦрд╛рд░", "рдардВрдб рд▓рдЧрдирд╛", "рдкрд╕реАрдирд╛ рдЖрдирд╛", "рд╢рд░реАрд░ рдХрд╛ рддрд╛рдкрдорд╛рди рдмрдврд╝рдирд╛", 
        "рдмреБрдЦрд╛рд░ рдЖрдирд╛-рдЬрд╛рдирд╛", "рддреЗрдЬ рдмреБрдЦрд╛рд░ (104┬░F+)", "рд╣рд▓реНрдХрд╛ рдмреБрдЦрд╛рд░ (100-101┬░F)"
    ]
    
    basic_symptoms = [
        "рдердХрд╛рди", "рд╕рд┐рд░рджрд░реНрдж", "рдорддрд▓реА", "рдЙрд▓реНрдЯреА", 
        "рдорд╛рдВрд╕рдкреЗрд╢рд┐рдпреЛрдВ рдореЗрдВ рджрд░реНрдж", "рдЬреЛрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдж", "рдХрдордЬреЛрд░реА", "рдЪрдХреНрдХрд░ рдЖрдирд╛",
        "рднреВрдЦ рди рд▓рдЧрдирд╛", "рд╢рд░реАрд░ рдореЗрдВ рджрд░реНрдж"
    ]
    
    respiratory_symptoms = [
        "рдЦрд╛рдВрд╕реА", "рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рддрдХрд▓реАрдл", "рдЫрд╛рддреА рдореЗрдВ рдЬрдХрдбрд╝рди", "рдмрд╣рддреА рдирд╛рдХ", 
        "рдЧрд▓реЗ рдореЗрдВ рдЦрд░рд╛рд╢", "рдЫреАрдВрдХ рдЖрдирд╛", "рдШрд░рдШрд░рд╛рд╣рдЯ", "рдЧрдВрдз рди рдЖрдирд╛", "рд╕реНрд╡рд╛рдж рди рдЖрдирд╛"
    ]
    
    digestive_symptoms = [
        "рджрд╕реНрдд", "рдкреЗрдЯ рджрд░реНрдж", "рдкреЗрдЯ рдлреВрд▓рдирд╛", "рдХрдмреНрдЬ", "рд╕реАрдиреЗ рдореЗрдВ рдЬрд▓рди", 
        "рдорд▓ рдореЗрдВ рдЦреВрди", "рдирд┐рдЧрд▓рдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ", "рдЕрддреНрдпрдзрд┐рдХ рдкреНрдпрд╛рд╕ рд▓рдЧрдирд╛", 
        "рдмрд╛рд░-рдмрд╛рд░ рдкреЗрд╢рд╛рдм рдЖрдирд╛", "рдкреЗрдЯ рдореЗрдВ рдРрдВрдарди"
    ]
    
    skin_symptoms = [
        "рдЪрдХрддреНрддреЗ", "рдЦреБрдЬрд▓реА", "рдкреАрд▓реА рддреНрд╡рдЪрд╛/рдЖрдВрдЦреЗрдВ", "рддреНрд╡рдЪрд╛ рдХрд╛ рд░рдВрдЧ рдмрджрд▓рдирд╛",
        "рдкрд┐рддреНрддреА", "рд╕реВрдЬрди", "рдЖрд╕рд╛рдиреА рд╕реЗ рдЪреЛрдЯ рд▓рдЧрдирд╛", "рд░рд╛рдд рдХреЛ рдкрд╕реАрдирд╛ рдЖрдирд╛",
        "рддреНрд╡рдЪрд╛ рдкрд░ рд▓рд╛рд▓ рдзрдмреНрдмреЗ", "рдЖрдВрдЦреЛрдВ рдореЗрдВ рджрд░реНрдж", "рдЖрдВрдЦреЛрдВ рдХрд╛ рд▓рд╛рд▓ рд╣реЛрдирд╛"
    ]
    
    neurological_symptoms = [
        "рднреНрд░рдо", "рдпрд╛рджрджрд╛рд╢реНрдд рдХреА рд╕рдорд╕реНрдпрд╛", "рд╕реБрдиреНрдирддрд╛", "рдЭреБрдирдЭреБрдиреА рд╕рдирд╕рдиреА",
        "рджреГрд╖реНрдЯрд┐ рд╕рдВрдмрдВрдзреА рд╕рдорд╕реНрдпрд╛рдПрдВ", "рд╕реБрдирдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛", "рд╕рдВрддреБрд▓рди рдХреА рд╕рдорд╕реНрдпрд╛", "рджреМрд░реЗ",
        "рдмреЛрд▓рдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ", "рдХрдВрдкрди", "рддреЗрдЬ рд╕рд┐рд░рджрд░реНрдж"
    ]
    
    heart_symptoms = [
        "рд╕реАрдиреЗ рдореЗрдВ рджрд░реНрдж/рджрдмрд╛рд╡", "рдмрд╛рдВрд╣/рдЬрдмрдбрд╝реЗ/рдкреАрда/рдЧрд░реНрджрди/рдЧрд▓реЗ рдореЗрдВ рджрд░реНрдж рдлреИрд▓рдирд╛", 
        "рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рддрдХрд▓реАрдл", "рддреЗрдЬ/рдЕрдирд┐рдпрдорд┐рдд рдзрдбрд╝рдХрди", "рдкреИрд░/рдЯрдЦрдиреЛрдВ/рдкреИрд░реЛрдВ рдореЗрдВ рд╕реВрдЬрди",
        "рд╡реНрдпрд╛рдпрд╛рдо рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХрдо рд╣реЛрдирд╛", "рд▓рдЧрд╛рддрд╛рд░ рдЦрд╛рдВрд╕реА", "рдкреЗрдЯ рдореЗрдВ рд╕реВрдЬрди",
        "рддреЗрдЬреА рд╕реЗ рд╡рдЬрди рдмрдврд╝рдирд╛", "рдардВрдбреЗ рдкрд╕реАрдиреЗ рдЖрдирд╛", "рдзрдбрд╝рдХрди рддреЗрдЬ рд╣реЛрдирд╛"
    ]
    
    cancer_symptoms = [
        "рд╕реНрддрди рдореЗрдВ рдЧрд╛рдВрда/рдореЛрдЯрд╛рдкрди", "рдЕрд╕рд╛рдорд╛рдиреНрдп рдирд┐рдкреНрдкрд▓ рдбрд┐рд╕реНрдЪрд╛рд░реНрдЬ", "рд╢реНрд░реЛрдгрд┐ рдореЗрдВ рджрд░реНрдж/рд╕реВрдЬрди",
        "рдкреЗрдЯ рджрд░реНрдж/рд╕реВрдЬрди", "рдкреНрд░реЛрд╕реНрдЯреЗрдЯ рд╕рдорд╕реНрдпрд╛рдПрдВ", "рдЕрдВрдбрдХреЛрд╖ рдореЗрдВ рдЧрд╛рдВрда/рд╕реВрдЬрди",
        "рдЕрд╕рд╛рдорд╛рдиреНрдп рд░рдХреНрддрд╕реНрд░рд╛рд╡/рдЪреЛрдЯ", "рд▓рдЧрд╛рддрд╛рд░ рджрд░реНрдж", "рдореБрдВрд╣ рдХреЗ рдЫрд╛рд▓реЗ/рд░рдХреНрддрд╕реНрд░рд╛рд╡/рд╕реБрдиреНрдирддрд╛",
        "рд▓рдЧрд╛рддрд╛рд░ рдЦрд╛рдВрд╕реА/рдЖрд╡рд╛рдЬ рдмреИрдардирд╛", "рдмрд┐рдирд╛ рдХрд╛рд░рдг рд╡рдЬрди рдХрдо рд╣реЛрдирд╛", "рд╕реВрдЬрди/рдЧрд╛рдВрда",
        "рддреНрд╡рдЪрд╛ рдореЗрдВ рдмрджрд▓рд╛рд╡/рдкреАрд▓рд┐рдпрд╛/рдирдП рддрд┐рд▓", "рд▓рдЧрд╛рддрд╛рд░ рд╕рд┐рд░рджрд░реНрдж", "рдЕрддреНрдпрдзрд┐рдХ рдердХрд╛рди",
        "рджреГрд╖реНрдЯрд┐/рд╢реНрд░рд╡рдг рд╕рдВрдмрдВрдзреА рд╕рдорд╕реНрдпрд╛рдПрдВ", "рдирд┐рдЧрд▓рдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ", "рдорд▓ рддреНрдпрд╛рдЧ рдХреА рдЖрджрддреЛрдВ рдореЗрдВ рдмрджрд▓рд╛рд╡"
    ]

    # рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓рдХреНрд╖рдг рдЪрдпрди
    st.subheader("ЁЯМбя╕П рдмреБрдЦрд╛рд░ рдФрд░ рд╕рдВрдХреНрд░рдордг рд╕рдВрдмрдВрдзреА рд▓рдХреНрд╖рдг")
    selected_fever = st.multiselect("рдмреБрдЦрд╛рд░ рдХреЗ рд▓рдХреНрд╖рдг", fever_symptoms)
    
    st.subheader("ЁЯФН рдЕрдиреНрдп рд▓рдХреНрд╖рдг")
    selected_basic = st.multiselect("рд╕рд╛рдорд╛рдиреНрдп рд▓рдХреНрд╖рдг", basic_symptoms)
    selected_respiratory = st.multiselect("рд╢реНрд╡рд╕рди рд╕рдВрдмрдВрдзреА рд▓рдХреНрд╖рдг", respiratory_symptoms)
    selected_digestive = st.multiselect("рдкрд╛рдЪрди рд╕рдВрдмрдВрдзреА рд▓рдХреНрд╖рдг", digestive_symptoms)
    selected_skin = st.multiselect("рддреНрд╡рдЪрд╛ рдФрд░ рд░реВрдк рд╕рдВрдмрдВрдзреА рд▓рдХреНрд╖рдг", skin_symptoms)
    selected_neurological = st.multiselect("рдиреНрдпреВрд░реЛрд▓реЙрдЬрд┐рдХрд▓ рд▓рдХреНрд╖рдг", neurological_symptoms)
    selected_cancer = st.multiselect("рдХреИрдВрд╕рд░ рдХреЗ рд▓рдХреНрд╖рдг", cancer_symptoms)
    selected_heart = st.multiselect("рд╣реГрджрдп рдФрд░ рд╕рдВрдЪрд╛рд░ рд╕рдВрдмрдВрдзреА рд▓рдХреНрд╖рдг", heart_symptoms)

    # рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА
    st.subheader("ЁЯУЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА")
    col3, col4 = st.columns(2)
    with col3:
        symptom_duration = st.selectbox("рдЖрдкрдХреЛ рдпреЗ рд▓рдХреНрд╖рдг рдХрд┐рддрдиреЗ рд╕рдордп рд╕реЗ рд╣реИрдВ?", 
                                      ["1 рд╕рдкреНрддрд╛рд╣ рд╕реЗ рдХрдо", "1-2 рд╕рдкреНрддрд╛рд╣", "2-4 рд╕рдкреНрддрд╛рд╣", "1-3 рдорд╣реАрдиреЗ", "3 рдорд╣реАрдиреЗ рд╕реЗ рдЕрдзрд┐рдХ"])
        severity = st.select_slider("рд▓рдХреНрд╖рдгреЛрдВ рдХреА рдЧрдВрднреАрд░рддрд╛", options=["рд╣рд▓реНрдХреЗ", "рдордзреНрдпрдо", "рдЧрдВрднреАрд░"])
        fever_pattern = st.selectbox("рдмреБрдЦрд╛рд░ рдХрд╛ рдкреИрдЯрд░реНрди", 
                                   ["рд▓рдЧрд╛рддрд╛рд░ рдмреБрдЦрд╛рд░", "рдмреБрдЦрд╛рд░ рдЖрдирд╛-рдЬрд╛рдирд╛", "рд╕реБрдмрд╣ рдХрдо/рд╢рд╛рдо рдХреЛ рдЬреНрдпрд╛рджрд╛", "рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдкреИрдЯрд░реНрди рдирд╣реАрдВ"])
    with col4:
        smoking = st.checkbox("рдзреВрдореНрд░рдкрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛")
        alcohol = st.checkbox("рдирд┐рдпрдорд┐рдд рд╢рд░рд╛рдм рдХрд╛ рд╕реЗрд╡рди")
        exercise = st.selectbox("рд╡реНрдпрд╛рдпрд╛рдо рдХреА рдЖрд╡реГрддреНрддрд┐", 
                              ["рдХрднреА рдирд╣реАрдВ", "рдХрднреА-рдХрднреА", "рд╕рдкреНрддрд╛рд╣ рдореЗрдВ 1-2 рдмрд╛рд░", "рд╕рдкреНрддрд╛рд╣ рдореЗрдВ 3-5 рдмрд╛рд░", "рд░реЛрдЬ"])
        recent_travel = st.checkbox("рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдпрд╛рддреНрд░рд╛ рдХреА рд╣реИ")

    submitted = st.form_submit_button("ЁЯФН рд▓рдХреНрд╖рдгреЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ")

# ---------- рдмреАрдПрдордЖрдИ рдЧрдгрдирд╛ ----------
def calculate_bmi(weight, height_cm):
    height_m = height_cm / 100
    bmi = weight / (height_m ** 2)
    if bmi < 18.5:
        category = "рдХрдо рд╡рдЬрди"
    elif 18.5 <= bmi < 25:
        category = "рд╕рд╛рдорд╛рдиреНрдп"
    elif 25 <= bmi < 30:
        category = "рдЕрдзрд┐рдХ рд╡рдЬрди"
    else:
        category = "рдореЛрдЯрд╛рдкрд╛"
    return bmi, category

# ---------- рдЙрдиреНрдирдд рдирд┐рджрд╛рди рд▓реЙрдЬрд┐рдХ ----------
def enhanced_diagnose(fever, basic, respiratory, digestive, skin, neurological, cancer, heart, age, medical_history, lifestyle, fever_pattern, recent_travel):
    conditions = []
    risk_factors = []
    recommendations = []
    risk_score = 0
    
    all_symptoms = fever + basic + respiratory + digestive + skin + neurological + cancer + heart
    symptom_count = len(all_symptoms)
    
    # рдЪрд┐рдХрд┐рддреНрд╕рд╛ рдЗрддрд┐рд╣рд╛рд╕ рдФрд░ рдЬреАрд╡рдирд╢реИрд▓реА рд╕реЗ рдЬреЛрдЦрд┐рдо рдХрд╛рд░рдХ
    if medical_history.get('bp'): risk_factors.append("рдЙрдЪреНрдЪ рд░рдХреНрддрдЪрд╛рдк")
    if medical_history.get('diabetes'): risk_factors.append("рдордзреБрдореЗрд╣")
    if medical_history.get('heart'): risk_factors.append("рд╣реГрджрдп рд░реЛрдЧ рдЗрддрд┐рд╣рд╛рд╕")
    if medical_history.get('smoking'): risk_factors.append("рдзреВрдореНрд░рдкрд╛рди")
    if medical_history.get('alcohol'): risk_factors.append("рд╢рд░рд╛рдм рдХрд╛ рд╕реЗрд╡рди")
    if recent_travel: risk_factors.append("рд╣рд╛рд▓ рдХреА рдпрд╛рддреНрд░рд╛")
    
    # -------------------------------
    # рдмреБрдЦрд╛рд░ рдФрд░ рд╕рдВрдХреНрд░рдордг рд╡рд┐рд╢реНрд▓реЗрд╖рдг
    # -------------------------------
    
    # рд╕рд╛рдорд╛рдиреНрдп рдмреБрдЦрд╛рд░ (Normal Fever)
    if "рдмреБрдЦрд╛рд░" in fever and len(fever) == 1 and len([s for s in basic if s in ["рд╕рд┐рд░рджрд░реНрдж", "рд╢рд░реАрд░ рдореЗрдВ рджрд░реНрдж", "рдердХрд╛рди"]]) >= 2:
        conditions.append(("рд╕рд╛рдорд╛рдиреНрдп рдмреБрдЦрд╛рд░ (рд╡рд╛рдпрд░рд▓ рдлреАрд╡рд░)", "рдкреНрд░рддрд┐рд░рдХреНрд╖рд╛ рдкреНрд░рдгрд╛рд▓реА", "рдХрдо"))
        recommendations.append("рдЖрд░рд╛рдо рдХрд░реЗрдВ, рд╣рд╛рдЗрдбреНрд░реЗрдЯреЗрдб рд░рд╣реЗрдВ, рдФрд░ рдкреИрд░рд╛рд╕рд┐рдЯрд╛рдореЛрд▓ рд▓реЗрдВ")
    
    # рд╡рд╛рдпрд░рд▓ рдлреАрд╡рд░ (Viral Fever)
    viral_fever_symptoms = ["рдмреБрдЦрд╛рд░", "рд╕рд┐рд░рджрд░реНрдж", "рд╢рд░реАрд░ рдореЗрдВ рджрд░реНрдж", "рдердХрд╛рди", "рдХрдордЬреЛрд░реА"]
    viral_count = sum(1 for symptom in viral_fever_symptoms if symptom in (fever + basic))
    if viral_count >= 4:
        conditions.append(("рд╡рд╛рдпрд░рд▓ рдлреАрд╡рд░", "рдкреНрд░рддрд┐рд░рдХреНрд╖рд╛ рдкреНрд░рдгрд╛рд▓реА", "рдордзреНрдпрдо"))
        recommendations.append("рднрд░рдкреВрд░ рдЖрд░рд╛рдо рдХрд░реЗрдВ рдФрд░ рддрд░рд▓ рдкрджрд╛рд░реНрде рд▓реЗрдВ")
    
    # рдбреЗрдВрдЧреВ (Dengue) - рдордЪреНрдЫрд░ рдЬрдирд┐рдд
    dengue_symptoms = ["рддреЗрдЬ рдмреБрдЦрд╛рд░ (104┬░F+)", "рддреЗрдЬ рд╕рд┐рд░рджрд░реНрдж", "рдЖрдВрдЦреЛрдВ рдореЗрдВ рджрд░реНрдж", "рдЬреЛрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдж", "рдорд╛рдВрд╕рдкреЗрд╢рд┐рдпреЛрдВ рдореЗрдВ рджрд░реНрдж", "рддреНрд╡рдЪрд╛ рдкрд░ рд▓рд╛рд▓ рдзрдмреНрдмреЗ"]
    dengue_count = sum(1 for symptom in dengue_symptoms if symptom in (fever + basic + skin))
    if dengue_count >= 4:
        conditions.append(("рдбреЗрдВрдЧреВ рдмреБрдЦрд╛рд░", "рд░рдХреНрдд рдФрд░ рдкреНрд░рддрд┐рд░рдХреНрд╖рд╛ рдкреНрд░рдгрд╛рд▓реА", "рдЙрдЪреНрдЪ"))
        risk_factors.append("рдордЪреНрдЫрд░ рдЬрдирд┐рдд рд╕рдВрдХреНрд░рдордг")
        recommendations.append("ЁЯЪи рддреБрд░рдВрдд рд░рдХреНрдд рдЬрд╛рдВрдЪ рдХрд░рд╛рдПрдВ рдФрд░ рдбреЙрдХреНрдЯрд░ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ")
        recommendations.append("рдкреНрд▓реЗрдЯрд▓реЗрдЯ рдХрд╛рдЙрдВрдЯ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ")
    
    # рдорд▓реЗрд░рд┐рдпрд╛ (Malaria) - рдордЪреНрдЫрд░ рдЬрдирд┐рдд
    malaria_symptoms = ["рдмреБрдЦрд╛рд░ рдЖрдирд╛-рдЬрд╛рдирд╛", "рдардВрдб рд▓рдЧрдирд╛", "рдкрд╕реАрдирд╛ рдЖрдирд╛", "рд╕рд┐рд░рджрд░реНрдж", "рдорддрд▓реА", "рдердХрд╛рди"]
    malaria_count = sum(1 for symptom in malaria_symptoms if symptom in (fever + basic))
    if malaria_count >= 4 and fever_pattern in ["рдмреБрдЦрд╛рд░ рдЖрдирд╛-рдЬрд╛рдирд╛", "рд╕реБрдмрд╣ рдХрдо/рд╢рд╛рдо рдХреЛ рдЬреНрдпрд╛рджрд╛"]:
        conditions.append(("рдорд▓реЗрд░рд┐рдпрд╛", "рд░рдХреНрдд рдФрд░ рд▓рд┐рд╡рд░", "рдЙрдЪреНрдЪ"))
        risk_factors.append("рдордЪреНрдЫрд░ рдЬрдирд┐рдд рд╕рдВрдХреНрд░рдордг")
        recommendations.append("ЁЯЪи рдорд▓реЗрд░рд┐рдпрд╛ рдмреНрд▓рдб рдЯреЗрд╕реНрдЯ рдХрд░рд╛рдПрдВ")
        recommendations.append("рдПрдВрдЯреА-рдорд▓реЗрд░рд┐рдпрд▓ рджрд╡рд╛рдПрдВ рд╢реБрд░реВ рдХрд░реЗрдВ")
    
    # рдЯрд╛рдЗрдлрд╛рдЗрдб (Typhoid) - рдЬрд▓/рднреЛрдЬрди рдЬрдирд┐рдд
    typhoid_symptoms = ["рддреЗрдЬ рдмреБрдЦрд╛рд░ (104┬░F+)", "рд╕рд┐рд░рджрд░реНрдж", "рдХрдордЬреЛрд░реА", "рдкреЗрдЯ рджрд░реНрдж", "рджрд╕реНрдд рдпрд╛ рдХрдмреНрдЬ", "рднреВрдЦ рди рд▓рдЧрдирд╛"]
    typhoid_count = sum(1 for symptom in typhoid_symptoms if symptom in (fever + basic + digestive))
    if typhoid_count >= 4:
        conditions.append(("рдЯрд╛рдЗрдлрд╛рдЗрдб рдмреБрдЦрд╛рд░", "рдкрд╛рдЪрди рддрдВрддреНрд░ рдФрд░ рд░рдХреНрдд", "рдЙрдЪреНрдЪ"))
        risk_factors.append("рджреВрд╖рд┐рдд рднреЛрдЬрди/рдкрд╛рдиреА")
        recommendations.append("ЁЯЪи рд╡рд┐рдбрд╛рд▓ рдЯреЗрд╕реНрдЯ рдХрд░рд╛рдПрдВ рдФрд░ рдПрдВрдЯреАрдмрд╛рдпреЛрдЯрд┐рдХреНрд╕ рд╢реБрд░реВ рдХрд░реЗрдВ")
        recommendations.append("рд╣рд╛рдЗрдЬреАрди рдХрд╛ рд╡рд┐рд╢реЗрд╖ рдзреНрдпрд╛рди рд░рдЦреЗрдВ")
    
    # рдЪрд┐рдХрдирдЧреБрдирд┐рдпрд╛ (Chikungunya) - рдордЪреНрдЫрд░ рдЬрдирд┐рдд
    if "рдЬреЛрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдж" in basic and "рдмреБрдЦрд╛рд░" in fever and "рддреНрд╡рдЪрд╛ рдкрд░ рд▓рд╛рд▓ рдзрдмреНрдмреЗ" in skin:
        conditions.append(("рдЪрд┐рдХрдирдЧреБрдирд┐рдпрд╛", "рдЬреЛрдбрд╝ рдФрд░ рдкреНрд░рддрд┐рд░рдХреНрд╖рд╛ рдкреНрд░рдгрд╛рд▓реА", "рдордзреНрдпрдо"))
        recommendations.append("рдЬреЛрдбрд╝реЛрдВ рдХреЗ рджрд░реНрдж рдХреЗ рд▓рд┐рдП рдлрд┐рдЬрд┐рдпреЛрдереЗрд░реЗрдкреА рд▓реЗрдВ")
    
    # -------------------------------
    # рдЕрдиреНрдп рд╕реНрдерд┐рддрд┐рдпрд╛рдВ
    # -------------------------------
    
    # рд╢реНрд╡рд╕рди рд╕рдВрдХреНрд░рдордг
    respiratory_symptom_count = len(respiratory)
    if respiratory_symptom_count >= 2 and "рдмреБрдЦрд╛рд░" in fever:
        if "рдЦрд╛рдВрд╕реА" in respiratory and "рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рддрдХрд▓реАрдл" in respiratory:
            conditions.append(("рд╢реНрд╡рд╕рди рд╕рдВрдХреНрд░рдордг (COVID-19/рдЗрдиреНрдлреНрд▓реБрдПрдВрдЬрд╛/рдирд┐рдореЛрдирд┐рдпрд╛)", "рд╢реНрд╡рд╕рди рдкреНрд░рдгрд╛рд▓реА", "рдЙрдЪреНрдЪ"))
        if "рдШрд░рдШрд░рд╛рд╣рдЯ" in respiratory and "рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рддрдХрд▓реАрдл" in respiratory:
            conditions.append(("рдЕрд╕реНрдердорд╛/рдмреНрд░реЛрдВрдХрд╛рдЗрдЯрд┐рд╕", "рд╢реНрд╡рд╕рди рдкреНрд░рдгрд╛рд▓реА", "рдордзреНрдпрдо"))
    
    # рдкрд╛рдЪрди рд╕рдВрдХреНрд░рдордг
    digestive_symptom_count = len(digestive)
    if digestive_symptom_count >= 3 and "рдмреБрдЦрд╛рд░" in fever:
        if "рджрд╕реНрдд" in digestive and "рдкреЗрдЯ рджрд░реНрдж" in digestive:
            conditions.append(("рдЧреИрд╕реНрдЯреНрд░реЛрдПрдВрдЯреЗрд░рд╛рдЗрдЯрд┐рд╕", "рдкрд╛рдЪрди рддрдВрддреНрд░", "рдордзреНрдпрдо"))
        if "рдорд▓ рдореЗрдВ рдЦреВрди" in digestive:
            conditions.append(("рдкреЗрдЪрд┐рд╢/рдЖрдВрддреНрд░рд╢реЛрде", "рдкрд╛рдЪрди рддрдВрддреНрд░", "рдЙрдЪреНрдЪ"))
    
    # рд╣реЗрдкреЗрдЯрд╛рдЗрдЯрд┐рд╕
    if "рдкреАрд▓реА рддреНрд╡рдЪрд╛/рдЖрдВрдЦреЗрдВ" in skin and "рдмреБрдЦрд╛рд░" in fever:
        conditions.append(("рд╣реЗрдкреЗрдЯрд╛рдЗрдЯрд┐рд╕/рд▓рд┐рд╡рд░ рд╕рдВрдХреНрд░рдордг", "рд▓рд┐рд╡рд░", "рдЙрдЪреНрдЪ"))
    
    # рд╣реГрджрдп рд╕рдВрдмрдВрдзреА рдЬреЛрдЦрд┐рдо рдореВрд▓реНрдпрд╛рдВрдХрди
    heart_symptom_count = len(heart)
    if heart_symptom_count >= 2:
        conditions.append(("рд╣реГрджрдп рд╕рдВрдмрдВрдзреА рд╕рдорд╕реНрдпрд╛", "рд╣реГрджрдп/рд╕рдВрдЪрд╛рд░ рдкреНрд░рдгрд╛рд▓реА", "рдЙрдЪреНрдЪ"))
        if "рд╕реАрдиреЗ рдореЗрдВ рджрд░реНрдж/рджрдмрд╛рд╡" in heart:
            recommendations.append("ЁЯЪи рд╕реАрдиреЗ рдореЗрдВ рджрд░реНрдж рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рдЪрд┐рдХрд┐рддреНрд╕рдХреАрдп рд╕рд╣рд╛рдпрддрд╛ рд▓реЗрдВ")
    
    # рдХреИрдВрд╕рд░ рдЬреЛрдЦрд┐рдо рдореВрд▓реНрдпрд╛рдВрдХрди
    cancer_symptom_count = len(cancer)
    if cancer_symptom_count >= 2:
        risk_level = "рдЙрдЪреНрдЪ" if cancer_symptom_count >= 3 or medical_history.get('cancer_history') else "рдордзреНрдпрдо"
        conditions.append(("рд╕рдВрднрд╛рд╡рд┐рдд рдХреИрдВрд╕рд░ рд╕рдВрдХреЗрддрдХ", "рдХрдИ рдкреНрд░рдгрд╛рд▓рд┐рдпрд╛рдВ", risk_level))
        recommendations.append("рдЖрдЧреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рд▓рд┐рдП рдСрдиреНрдХреЛрд▓реЙрдЬрд┐рд╕реНрдЯ рд╕реЗ рдкрд░рд╛рдорд░реНрд╢ рдХрд░реЗрдВ")
    
    # рдЬреАрд╡рдирд╢реИрд▓реА рдЬреЛрдЦрд┐рдо рдореВрд▓реНрдпрд╛рдВрдХрди
    if lifestyle.get('exercise') in ["рдХрднреА рдирд╣реАрдВ", "рдХрднреА-рдХрднреА"] and medical_history.get('bp'):
        risk_factors.append("рдирд┐рд╖реНрдХреНрд░рд┐рдп рдЬреАрд╡рдирд╢реИрд▓реА")
        recommendations.append("рд╢рд╛рд░реАрд░рд┐рдХ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рд╕рдкреНрддрд╛рд╣ рдореЗрдВ 150 рдорд┐рдирдЯ рддрдХ рдмрдврд╝рд╛рдПрдВ")
    
    # рд╡реНрдпрд╛рдкрдХ рдЬреЛрдЦрд┐рдо рд╕реНрдХреЛрд░ рдХреА рдЧрдгрдирд╛
    base_score = min(symptom_count * 4, 40)
    age_score = min(age * 0.5, 20)
    medical_score = len(risk_factors) * 5
    lifestyle_score = 0
    if lifestyle.get('smoking'): lifestyle_score += 10
    if lifestyle.get('alcohol'): lifestyle_score += 5
    if lifestyle.get('exercise') in ["рдХрднреА рдирд╣реАрдВ", "рдХрднреА-рдХрднреА"]: lifestyle_score += 5
    
    # рдмреБрдЦрд╛рд░ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реНрдХреЛрд░
    fever_score = len(fever) * 3
    risk_score = min(base_score + age_score + medical_score + lifestyle_score + fever_score, 95)
    
    # рд╕рд╛рдорд╛рдиреНрдп рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ
    if "рдмреБрдЦрд╛рд░" in fever:
        recommendations.append("рддрд╛рдкрдорд╛рди рдХреА рдирд┐рдпрдорд┐рдд рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ")
        recommendations.append("рдкрд░реНрдпрд╛рдкреНрдд рдорд╛рддреНрд░рд╛ рдореЗрдВ рддрд░рд▓ рдкрджрд╛рд░реНрде рдкрд┐рдПрдВ")
    
    if risk_score > 50:
        recommendations.append("рдкреНрд░рд╛рдердорд┐рдХ рджреЗрдЦрднрд╛рд▓ рдЪрд┐рдХрд┐рддреНрд╕рдХ рдХреЗ рд╕рд╛рде рдЕрдкреЙрдЗрдВрдЯрдореЗрдВрдЯ рд╢реЗрдбреНрдпреВрд▓ рдХрд░реЗрдВ")
    if symptom_count > 5:
        recommendations.append("рд╡реНрдпрд╛рдкрдХ рдЪрд┐рдХрд┐рддреНрд╕рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ")
    
    return conditions, risk_factors, recommendations, risk_score

# ---------- рдкрд░рд┐рдгрд╛рдо рджрд┐рдЦрд╛рдПрдВ ----------
if submitted:
    if not name or not mobile:
        st.error("тЭМ рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдирд╛рдо рдФрд░ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рджрд░реНрдЬ рдХрд░реЗрдВред")
    else:
        # рдмреАрдПрдордЖрдИ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ
        bmi_value, bmi_category = calculate_bmi(weight, height)
        
        # рдирд┐рджрд╛рди рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рддреИрдпрд╛рд░ рдХрд░реЗрдВ
        medical_history = {
            'bp': bp, 'diabetes': diabetes, 'heart': heart, 'thyroid': thyroid,
            'asthma': asthma, 'kidney': kidney, 'liver': liver, 'cancer_history': cancer_history
        }
        
        lifestyle = {
            'smoking': smoking, 'alcohol': alcohol, 'exercise': exercise
        }
        
        # рдирд┐рджрд╛рди рдХрд░реЗрдВ
        conditions, risk_factors, recommendations, risk_score = enhanced_diagnose(
            selected_fever, selected_basic, selected_respiratory, selected_digestive, 
            selected_skin, selected_neurological, selected_cancer, 
            selected_heart, age, medical_history, lifestyle, fever_pattern, recent_travel
        )

        # рдкрд░рд┐рдгрд╛рдо рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ
        st.success("## ЁЯУК рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдкрд░рд┐рдгрд╛рдо")
        
        # рдмреАрдПрдордЖрдИ рдФрд░ рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА
        col1, col2, col3 = st.columns(3)
        with col1:
            st.metric("рдмреАрдПрдордЖрдИ рд╕реНрдХреЛрд░", f"{bmi_value:.1f}", bmi_category)
        with col2:
            st.metric("рдХреБрд▓ рдЬреЛрдЦрд┐рдо рд╕реНрдХреЛрд░", f"{risk_score:.1f}%")
        with col3:
            total_symptoms = len(selected_fever + selected_basic + selected_respiratory + 
                               selected_digestive + selected_skin + selected_neurological + 
                               selected_cancer + selected_heart)
            st.metric("рд▓рдХреНрд╖рдгреЛрдВ рдХреА рд╕реВрдЪрдирд╛", total_symptoms)
        
        # рдмреБрдЦрд╛рд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг
        if selected_fever:
            st.info("## ЁЯМбя╕П рдмреБрдЦрд╛рд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг")
            fever_symptoms_text = ", ".join(selected_fever)
            st.write(f"**рдЪрдпрдирд┐рдд рдмреБрдЦрд╛рд░ рд▓рдХреНрд╖рдг:** {fever_symptoms_text}")
            st.write(f"**рдмреБрдЦрд╛рд░ рдкреИрдЯрд░реНрди:** {fever_pattern}")
            
            # рдмреБрдЦрд╛рд░ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢
            if any("рдбреЗрдВрдЧреВ" in cond[0] for cond in conditions):
                st.warning("ЁЯФ┤ **рдбреЗрдВрдЧреВ рдХреЗ рд▓рдХреНрд╖рдг:** рдЙрдЪреНрдЪ рдмреБрдЦрд╛рд░, рд╕рд┐рд░рджрд░реНрдж, рдЖрдВрдЦреЛрдВ рдореЗрдВ рджрд░реНрдж, рдЬреЛрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдж")
            if any("рдорд▓реЗрд░рд┐рдпрд╛" in cond[0] for cond in conditions):
                st.warning("ЁЯФ┤ **рдорд▓реЗрд░рд┐рдпрд╛ рдХреЗ рд▓рдХреНрд╖рдг:** рдмреБрдЦрд╛рд░ рдЖрдирд╛-рдЬрд╛рдирд╛, рдардВрдб рд▓рдЧрдирд╛, рдкрд╕реАрдирд╛ рдЖрдирд╛")
            if any("рдЯрд╛рдЗрдлрд╛рдЗрдб" in cond[0] for cond in conditions):
                st.warning("ЁЯФ┤ **рдЯрд╛рдЗрдлрд╛рдЗрдб рдХреЗ рд▓рдХреНрд╖рдг:** рд▓рдЧрд╛рддрд╛рд░ рдЙрдЪреНрдЪ рдмреБрдЦрд╛рд░, рдкреЗрдЯ рджрд░реНрдж, рдХрдордЬреЛрд░реА")
        
        # рдкрд╛рдП рдЧрдП рд░реЛрдЧ
        if conditions:
            st.warning("## ЁЯЪи рд╕рдВрднрд╛рд╡рд┐рдд рд╕реНрдерд┐рддрд┐рдпрд╛рдВ рдкрд╛рдИ рдЧрдИрдВ")
            for condition, system, risk_level in conditions:
                risk_color = "ЁЯФ┤" if risk_level == "рдЙрдЪреНрдЪ" else "ЁЯЯб" if risk_level == "рдордзреНрдпрдо" else "ЁЯЯв"
                st.write(f"{risk_color} **{condition}**")
                st.write(f"   тАв рдкреНрд░рднрд╛рд╡рд┐рдд рдкреНрд░рдгрд╛рд▓реА: {system}")
                st.write(f"   тАв рдЬреЛрдЦрд┐рдо рд╕реНрддрд░: {risk_level}")
                st.write("")
        else:
            st.info("## тЬЕ рдХреЛрдИ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмреАрдорд╛рд░реА рд╕рдВрдХреЗрддрдХ рдирд╣реАрдВ рдорд┐рд▓реЗ")
        
        # рдЬреЛрдЦрд┐рдо рдХрд╛рд░рдХ
        if risk_factors:
            st.error("## тЪая╕П рдкрд╣рдЪрд╛рдиреЗ рдЧрдП рдЬреЛрдЦрд┐рдо рдХрд╛рд░рдХ")
            for factor in risk_factors:
                st.write(f"тАв {factor}")
        
        # рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ
        if recommendations:
            st.success("## ЁЯТб рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ")
            for recommendation in recommendations:
                st.write(f"тАв {recommendation}")
        
        # рд╕рд╛рдорд╛рдиреНрдп рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╕реБрдЭрд╛рд╡
        st.info("## ЁЯМЯ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрд╡рд╛рд╕реНрдереНрдп рд╕реБрдЭрд╛рд╡")
        if "рдмреБрдЦрд╛рд░" in selected_fever:
            st.write("тАв рднрд░рдкреВрд░ рдЖрд░рд╛рдо рдХрд░реЗрдВ рдФрд░ рд╣рд╛рдЗрдбреНрд░реЗрдЯреЗрдб рд░рд╣реЗрдВ")
            st.write("тАв рддрд╛рдкрдорд╛рди рдХреА рдирд┐рдпрдорд┐рдд рдЬрд╛рдВрдЪ рдХрд░реЗрдВ")
            st.write("тАв рдбреЙрдХреНрдЯрд░ рдХреА рд╕рд▓рд╛рд╣ рдХреЗ рдмрд┐рдирд╛ рдПрдВрдЯреАрдмрд╛рдпреЛрдЯрд┐рдХреНрд╕ рди рд▓реЗрдВ")
        
        if bmi_category in ["рдЕрдзрд┐рдХ рд╡рдЬрди", "рдореЛрдЯрд╛рдкрд╛"]:
            st.write("тАв рд╕рдВрддреБрд▓рд┐рдд рдЖрд╣рд╛рд░ рдФрд░ рд╡реНрдпрд╛рдпрд╛рдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рдЬрди рдкреНрд░рдмрдВрдзрди рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ")
        
        if age > 50:
            st.write("тАв рдЙрдореНрд░ рдХреЗ рдХрд╛рд░рдг рдирд┐рдпрдорд┐рдд рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдВрдЪ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ")

        # ---------- рдЧреВрдЧрд▓ рд╢реАрдЯ рдореЗрдВ рдбреЗрдЯрд╛ рд╕реЗрд╡ рдХрд░реЗрдВ ----------
        entry_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        all_symptoms = selected_fever + selected_basic + selected_respiratory + selected_digestive + selected_skin + selected_neurological + selected_cancer + selected_heart
        condition_list = [f"{cond} ({risk})" for cond, sys, risk in conditions]
        
        # рд╕рдЯреАрдХ рдХреЙрд▓рдо рдХреНрд░рдо рдореЗрдВ рдбреЗрдЯрд╛ рдкрдВрдХреНрддрд┐ рддреИрдпрд╛рд░ рдХрд░реЗрдВ
        data = [
            entry_time, name, age, gender, mobile, bp, diabetes, heart, thyroid,
            asthma, kidney, liver, cancer_history, location, weight, height,
            ", ".join(all_symptoms), symptom_duration, severity, fever_pattern,
            smoking, alcohol, exercise, recent_travel,
            ", ".join(condition_list), ", ".join(risk_factors), 
            f"{risk_score:.1f}%", f"{bmi_value:.1f}", bmi_category
        ]
        
        try:
            sheet.append_row(data)
            st.success("тЬЕ рдЖрдкрдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╣рдорд╛рд░реЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рджрд░реНрдЬ рдХрд░ рджреА рдЧрдИ рд╣реИред")
        except Exception as e:
            st.error(f"тЪая╕П рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕реЗрд╡ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрд╛: {str(e)}")

# ---------- рд╕рд╛рдЗрдбрдмрд╛рд░ ----------
with st.sidebar:
    st.header("тД╣я╕П рдЗрд╕ рдЯреВрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ")
    st.write("""
    рдпрд╣ рдЙрдиреНрдирдд рд▓рдХреНрд╖рдг рдЬрд╛рдВрдЪрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ:
    - рд╕рд╛рдорд╛рдиреНрдп рдмреБрдЦрд╛рд░ vs рд╡рд╛рдпрд░рд▓ рдлреАрд╡рд░
    - рдбреЗрдВрдЧреВ, рдорд▓реЗрд░рд┐рдпрд╛, рдЯрд╛рдЗрдлрд╛рдЗрдб
    - рд╢реНрд╡рд╕рди рд╕рдВрдХреНрд░рдордг
    - рдкрд╛рдЪрди рд╡рд┐рдХрд╛рд░
    - рд╣реГрджрдп рд╕рдВрдмрдВрдзреА рдЬреЛрдЦрд┐рдо
    """)
    
    st.header("ЁЯМбя╕П рдмреБрдЦрд╛рд░ рдкреНрд░рдХрд╛рд░ рдЧрд╛рдЗрдб")
    fever_guide = {
        "рд╕рд╛рдорд╛рдиреНрдп рдмреБрдЦрд╛рд░": ["рд╣рд▓реНрдХрд╛ рдмреБрдЦрд╛рд░", "рд╕рд┐рд░рджрд░реНрдж", "рд╢рд░реАрд░ рджрд░реНрдж"],
        "рд╡рд╛рдпрд░рд▓ рдлреАрд╡рд░": ["рддреЗрдЬ рдмреБрдЦрд╛рд░", "рдердХрд╛рди", "рдХрдордЬреЛрд░реА", "рднреВрдЦ рди рд▓рдЧрдирд╛"],
        "рдбреЗрдВрдЧреВ": ["рддреЗрдЬ рдмреБрдЦрд╛рд░ (104┬░F+)", "рдЖрдВрдЦреЛрдВ рдореЗрдВ рджрд░реНрдж", "рдЬреЛрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдж", "рддреНрд╡рдЪрд╛ рдкрд░ рд░реИрд╢"],
        "рдорд▓реЗрд░рд┐рдпрд╛": ["рдмреБрдЦрд╛рд░ рдЖрдирд╛-рдЬрд╛рдирд╛", "рдардВрдб рд▓рдЧрдХрд░ рдмреБрдЦрд╛рд░ рдЖрдирд╛", "рдкрд╕реАрдирд╛ рдЖрдирд╛"],
        "рдЯрд╛рдЗрдлрд╛рдЗрдб": ["рд▓рдЧрд╛рддрд╛рд░ рдЙрдЪреНрдЪ рдмреБрдЦрд╛рд░", "рдкреЗрдЯ рджрд░реНрдж", "рджрд╕реНрдд/рдХрдмреНрдЬ", "рдХрдордЬреЛрд░реА"]
    }
    
    for fever_type, symptoms in fever_guide.items():
        with st.expander(f"{fever_type}"):
            for symptom in symptoms:
                st.write(f"тАв {symptom}")
    
    st.header("ЁЯЪи рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд▓рдХреНрд╖рдг")
    st.write("""
    рддрддреНрдХрд╛рд▓ рдЪрд┐рдХрд┐рддреНрд╕рдХреАрдп рджреЗрдЦрднрд╛рд▓ рд▓реЗрдВ:
    - 104┬░F рд╕реЗ рдЕрдзрд┐рдХ рдмреБрдЦрд╛рд░
    - рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ
    - рдЧрдВрднреАрд░ рдкреЗрдЯ рджрд░реНрдж
    - рд▓рдЧрд╛рддрд╛рд░ рдЙрд▓реНрдЯреА
    - рднреНрд░рдо рдпрд╛ рдЪрдХреНрдХрд░ рдЖрдирд╛
    - рддреНрд╡рдЪрд╛ рдкрд░ рд░реИрд╢ рдХреЗ рд╕рд╛рде рдмреБрдЦрд╛рд░
    """)

# ---------- рдлреБрдЯрд░ ----------
st.markdown("---")
st.caption("""
тЪая╕П **рдЕрд╕реНрд╡реАрдХрд░рдг**: рдпрд╣ рдЯреВрд▓ рдХреЗрд╡рд▓ рд╢реИрдХреНрд╖рд┐рдХ рдФрд░ рд╕реВрдЪрдирд╛рддреНрдордХ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИред 
рдпрд╣ рдЪрд┐рдХрд┐рддреНрд╕рдХреАрдп рд╕рд▓рд╛рд╣, рдирд┐рджрд╛рди рдпрд╛ рдЙрдкрдЪрд╛рд░ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред рдмреБрдЦрд╛рд░ рдпрд╛ рдЧрдВрднреАрд░ рд▓рдХреНрд╖рдгреЛрдВ рдХреЗ 
рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдореЗрд╢рд╛ рдпреЛрдЧреНрдп рд╕реНрд╡рд╛рд╕реНрдереНрдп рджреЗрдЦрднрд╛рд▓ рдкреЗрд╢реЗрд╡рд░реЛрдВ рд╕реЗ рдкрд░рд╛рдорд░реНрд╢ рд▓реЗрдВред
""")
